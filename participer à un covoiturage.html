<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participer √† un Covoiturage</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Menu -->
    <nav class="navbar navbar-expand-lg navbar-light bg-success">
        <div class="container-fluid">
            <a class="navbar-brand text-white" href="index.html">EcoRide</a>
        </div>
    </nav>
<!-- Contenu principal -->
<main class="container mt-4">
    <h1 class="text-center mb-4">Participer √† un covoiturage</h1>
    <h1 class="text-center mb-4">Organis√© par :</h1>
<div class="card">
    <div class="row g-0">
        <div class="col-md-4">
            <img src="file:///C:/Users/GIGABYTE/Pictures/Capture%20d%E2%80%99%C3%A9cran%202024-11-27%20162133.jpg" class="img-fluid rounded-start" alt="Photo du chauffeur">
        </div>
        <div class="col-md-8">
            <div class="card-body">
                <h5 class="card-title">Jean Dupont (4.5‚òÖ)</h5>
                <p class="card-text"><strong>D√©part :</strong> Ville A</p>
                <p class="card-text"><strong>Arriv√©e :</strong> Ville B</p>
                <p class="card-text"><strong>Date :</strong> 2024-11-25</p>
                <p class="card-text"><strong>Prix :</strong> 15‚Ç¨</p>
                <p class="card-text"><strong>Dur√©e :</strong> 2h30</p>
                <p class="card-text"><small class="text-muted">Voiture √©lectrique üå± : Tesla Model 3 (2021)</small></p>
                <p class="card-text"><strong>Places restantes :</strong> 2</p>
                
                <!-- V√©rification des cr√©dits de l'utilisateur -->
                <p id="userCredits" class="card-text"><strong>Cr√©dits disponibles :</strong> 20</p>
                
                <!-- Bouton pour participer -->
                <button id="participateBtn" class="btn btn-success" onclick="participer()">Participer</button>
            </div>
        </div>
    </div>
</div>

<!-- Fen√™tre de confirmation -->
<div id="confirmationModal" class="modal" style="display:none;">
    <div class="modal-content">
        <h3>Confirmer votre participation</h3>
        <p>√ätes-vous s√ªr de vouloir participer √† ce covoiturage ? Vous utiliserez 15 cr√©dits.</p>
        <button id="confirmBtn" class="btn btn-primary">Confirmer</button>
        <button id="cancelBtn" class="btn btn-secondary">Annuler</button>
    </div>
</div>

<SCript>
// Donn√©es fictives (ceci serait normalement r√©cup√©r√© via un backend)
let userCredits = 20;  // Cr√©dits de l'utilisateur
let ridePrice = 15;    // Prix du covoiturage   
let availableSeats = 2;  // Places restantes pour ce covoiturage

// Fonction pour g√©rer la participation
function participer() {
    // V√©rifier si l'utilisateur a suffisamment de cr√©dits
    if (userCredits < ridePrice) {
        alert("Vous n'avez pas suffisamment de cr√©dits pour participer √† ce covoiturage.");
        return;
    }

    // V√©rifier si des places sont disponibles
    if (availableSeats <= 0) {
        alert("Il n'y a plus de places disponibles pour ce covoiturage.");
        return;
    }

    // Afficher la fen√™tre de confirmation
    document.getElementById('confirmationModal').style.display = "block";
}

// Fonction pour confirmer la participation
document.getElementById('confirmBtn').addEventListener('click', function() {
    // Mettre √† jour les cr√©dits de l'utilisateur
    userCredits -= ridePrice;
    
    // Mettre √† jour le nombre de places disponibles
    availableSeats--;

    // Mettre √† jour l'interface pour afficher les nouvelles informations
    document.getElementById('userCredits').textContent = `Cr√©dits disponibles : ${userCredits}`;
    
    // Fermer la fen√™tre de confirmation
    document.getElementById('confirmationModal').style.display = "none";

    // Informer l'utilisateur de la participation r√©ussie
    alert("Vous avez bien √©t√© ajout√© comme passager √† ce covoiturage !");
});

// Fonction pour annuler la participation
document.getElementById('cancelBtn').addEventListener('click', function() {
    // Fermer la fen√™tre de confirmation sans rien changer
    document.getElementById('confirmationModal').style.display = "none";
});
</SCript>

<script>
app.post('/api/participate', (req, res) => {
    const { userId, rideId } = req.body;
    const query = 'INSERT INTO passengers (user_id, ride_id) VALUES (?, ?)';
    
    db.query(query, [userId, rideId], (err, results) => {
        if (err) {
            return res.status(500).json({ error: 'Erreur lors de l\'inscription au covoiturage.' });
        }
        res.json({ message: 'Participation enregistr√©e avec succ√®s.' });
    });
});
</script>